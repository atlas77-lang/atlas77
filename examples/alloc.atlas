import "std/mem";
import "std/io";

extern calloc<T>(size: int64) -> &T;

fun main() {
    let foo_ptr = test();
    foo_ptr.a = 10;
    foo_ptr.b = 20;
    print("Foo a: ");
    print(foo_ptr.a);
    print(", b: ");
    println(foo_ptr.b);   
}

struct Foo {
public:
    a: int64;
    b: int64;
}

fun malloc<T>(size: int64) -> &T {
    let ptr: &T = calloc<T>(size as uint64);
    return ptr;
}

fun test() -> &Foo {
    let foo: &Foo = malloc<Foo>(16);
    return foo;
} 