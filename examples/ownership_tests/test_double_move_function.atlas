// ============================================================================
// ERROR TEST: Double move in function call
// ============================================================================
// This should produce a compile-time error when passing moved value to function

import "std/io";

// Non-copyable struct (no _copy method)
struct Resource {
public:
    id: int64;
    hehe: float64;

    Resource(id: int64) {
        this.id = id;
        this.hehe = 3.14;
        println("Resource acquired");
    }

    ~Resource() {
        println("Resource released");
    }

    fun get_id(&const this) -> int64 {
        return *this.id;
    }
}

fun process(r: Resource) {
    println("Processing resource:");
    println(r.get_id());
}

fun main() {
    let resource = new Resource(1);
    
    // First call - moves resource
    while true {
        process(resource);
    }
    
    // Second call - ERROR: resource was already moved!
    process(resource);  // <-- Expected error: use after move
    
    println("Done");
}
