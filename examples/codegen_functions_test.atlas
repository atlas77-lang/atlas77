extern printf<T>(fmt: string, c: T);

// Function basics
fun add(a: int64, b: int64) -> int64 {
    return a + b;
}

fun say_hi() {
    // print a plain string via generic printf
    printf<string>("%s\n", "say_hi called");
}

// Generic function
fun identity<T>(x: T) -> T {
    return x;
}

// Simple increment
fun inc(x: int64) -> int64 {
    return x + 1;
}

// Recursion
fun factorial(n: int64) -> int64 {
    if (n <= 1) {
        return 1;
    }
    return n * factorial(n - 1);
}

//references
fun mut_ref(x: &int64)  {
    *x = *x + 1;
}

fun while_loop_example(n: int64) -> int64 {
    let result: int64 = 0;
    let i: int64 = 0;
    while (i < n) {
        result = result + i;
        i = i + 1;
    }
    return result;
}

// Test runner
fun main() {
    let all_ok: bool = true; // 1 = true, 0 = false

    // Test: add
    let r1: int64 = add(2, 3);
    printf<int64>("add(2,3) = %d\n", r1);
    if (r1 != 5) { printf<string>("FAIL: add expected 5\n", ""); all_ok = false; }

    // Test: say_hi (void)
    say_hi();

    // Test: generic identity
    let gi: int64 = identity<int64>(42);
    printf<int64>("identity(42) = %d\n", gi);
    if (gi != 42) { printf<string>("FAIL: identity expected 42\n", ""); all_ok = false; }

    // Test: recursion factorial
    let fact5: int64 = factorial(5);
    printf<int64>("factorial(5) = %d\n", fact5);
    if (fact5 != 120) { printf<string>("FAIL: factorial expected 120\n", ""); all_ok = false; }

    // Test: mutable reference
    let val: int64 = 10;
    mut_ref(&val);
    printf<int64>("mut_ref incremented value to %d\n", val);
    if (val != 11) { printf<string>("FAIL: mut_ref expected 11\n", ""); all_ok = false; }

    // Test: while loop
    let wl_result: int64 = while_loop_example(5);
    printf<int64>("while_loop_example(5) = %d\n", wl_result);
    if (wl_result != 10) { printf<string>("FAIL: while_loop_example expected 10\n", ""); all_ok = false; }

    // Summary
    if (all_ok) {
        printf<string>("ALL FUNCTION TESTS OK\n", "");
    } else {
        printf<string>("SOME FUNCTION TESTS FAILED\n", "");
    }
}
